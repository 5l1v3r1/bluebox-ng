/*
  Copyright Jesús Pérez <jesusprubio@gmail.com>

  This code may only be used under the GPLv3 license found at
  http://www.gnu.org/licenses/gpl-3.0.txt.
*/

'use strict';

const search = require('exploitsearch');

const utils = require('../utils');
const errMsgs = require('../utils/errorMsgs');

const Promise = utils.Promise;


module.exports = (query, opts = {}) => {
  if (!query) { return Promise.reject(new Error(errMsgs.paramReq)); }

  if ((opts.exploitsOnly && !utils.validator.isBoolean(opts.exploitsOnly.toString())) ||
      (opts.timeout && !utils.validator.isNumeric(opts.timeout.toString()))) {
    return Promise.reject(new Error(errMsgs.paramBad));
  }

  const finalOpts = {
    timeout: opts.timeout || 5000,
    exploits: opts.exploitsOnly || false,
  };

  return search('freepbx', finalOpts);
};
